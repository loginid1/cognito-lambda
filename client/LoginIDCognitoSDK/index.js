"use strict";var C=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var F=Object.prototype.hasOwnProperty;var k=(n,t)=>{for(var e in t)C(n,e,{get:t[e],enumerable:!0})},R=(n,t,e,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of E(t))!F.call(n,i)&&i!==e&&C(n,i,{get:()=>t[i],enumerable:!(o=I(t,i))||o.enumerable});return n};var x=n=>R(C({},"__esModule",{value:!0}),n);var J={};k(J,{default:()=>M});module.exports=x(J);var u=n=>{n=n.replace(/-/g,"+").replace(/_/g,"/");let t=atob(n),e=new Uint8Array(t.length);for(let o=0;o<t.length;o++)e[o]=t.charCodeAt(o);return e.buffer},a=n=>{let t=new Uint8Array(n),e="";for(let i=0;i<t.byteLength;i++)e+=String.fromCharCode(t[i]);return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")};var y=async n=>{let{challenge:t}=n;if(n.challenge=u(n.challenge),n.user.id=u(n.user.id),n.excludeCredentials)for(let r of n.excludeCredentials)r.id=u(r.id);let e=await navigator.credentials.create({publicKey:n});if(!e)throw new Error("Failed to create credential");let o=e.response;return{attestation_response:{challenge:t,id:a(e.rawId),type:e.type,response:{attestationObject:a(o.attestationObject),clientDataJSON:a(o.clientDataJSON),...o.getTransports&&{transports:o.getTransports()}}}}},b=async n=>{let t=n.challenge;if(n.challenge=u(t),n.allowCredentials)for(let r of n.allowCredentials)r.id=u(r.id);let e=await navigator.credentials.get({publicKey:n});if(!e)throw new Error("Failed to authenticate credential");let o=e.response;return{assertion_response:{challenge:t,id:a(e.rawId),type:e.type,response:{clientDataJSON:a(o.clientDataJSON),signature:a(o.signature),authenticatorData:a(o.authenticatorData),userHandle:o.userHandle?a(o.userHandle):null}}}};var l=require("amazon-cognito-identity-js");var d=class{userPool;constructor(t,e){this.userPool=new l.CognitoUserPool({UserPoolId:t,ClientId:e})}handleAttestationOptions(t){let e={};return t.attestationOptions?.overrideTimeout!==void 0&&(e.override_timeout_s=t.attestationOptions.overrideTimeout),t.attestationOptions?.requireResidentKey!==void 0&&(e.require_usernameless=t.attestationOptions.requireResidentKey),e}async customAuthenticationPasskey(t,e,o,i){return new Promise((r,m)=>{let _={Username:t,Password:""},T={Username:t,Pool:this.userPool},f=new l.AuthenticationDetails(_),c=new l.CognitoUser(T),O=i.metaData||{},D=this.handleAttestationOptions(i),S={customChallenge:async function(s){let A={...O,attestation_options:JSON.stringify(D),authentication_type:"FIDO2_CREATE"};if(s?.challenge==="AUTH_PARAMS"){c.sendCustomChallengeAnswer("AUTH_PARAMS",this,A);return}let h=JSON.parse(s.public_key),p=await y(h);c.sendCustomChallengeAnswer(JSON.stringify({...p,id_token:e}),this,A)},onSuccess:function(s){r(s)},onFailure:function(s){m(s)}},U={customChallenge:async function(s){let A={...O,authentication_type:"FIDO2_GET"};if(s?.challenge==="AUTH_PARAMS"){c.sendCustomChallengeAnswer("AUTH_PARAMS",this,A);return}let h=JSON.parse(s.public_key),p=await b(h);c.sendCustomChallengeAnswer(JSON.stringify({...p}),this,A)},onSuccess:function(s){r(s)},onFailure:function(s){m(s)}};switch(o){case"FIDO2_CREATE":c.setAuthenticationFlowType("CUSTOM_AUTH"),c.initiateAuth(f,S);break;case"FIDO2_GET":c.setAuthenticationFlowType("CUSTOM_AUTH"),c.initiateAuth(f,U);break;default:throw new Error("Invalid custom authentication type")}})}},w=d;var g=class{cognito;constructor(t,e){this.cognito=new w(t,e)}async addPasskey(t,e,o){return this.cognito.customAuthenticationPasskey(t,e,"FIDO2_CREATE",o||{})}async signInPasskey(t,e){return this.cognito.customAuthenticationPasskey(t,"","FIDO2_GET",e||{})}},P=g;var M=P;
//# sourceMappingURL=index.js.map